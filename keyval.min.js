!function(e){function n(){}function t(){for(var e={},n=0;n<arguments.length;n++){var t=arguments[n];for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}return e}var i=function(e){e=t(e,{engine:"memory"});var n,i,r={};return n="string"==typeof e.engine?o[e.engine]():"function"==typeof e.engine?e.engine():o[e.engine.name](e.engine),i=t({get:function(e){return r[e]},set:function(e,n,t){var i=this.has(e)?"update":"add";this.emit(i+":"+e,r[e],e),this.emit(i,r[e],e),r[e]=n,t&&this.save()},has:function(e){return e in r},remove:function(e,n){this.emit("remove:"+e,r[e],e),this.emit("remove",r[e],e),delete r[e],n&&this.save()},each:function(e){for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},getAll:function(){return r},removeAll:function(e){var n=this;this.each(function(e,t){n.emit("remove:"+t,e),n.emit("remove",e,t)}),r={},e&&this.save()},save:function(){this.emit("save",r),n.save(r)},load:function(){var e=this;r=n.restore(),this.emit("load",r),this.each(function(n,t){e.set(t,n)})}},s)},o={memory:function(){return{save:n,restore:function(){return{}}}},session:function(e){return e=t(e,{name:"keyval.default"}),{save:function(n){window.sessionStorage.setItem(e.name,JSON.stringify(n))},restore:function(){return window.sessionStorage.getItem(e.name)||{}}}},local:function(e){return e=t(e,{name:"keyval.default"}),{save:function(n){window.localStorage.setItem(e.name,JSON.stringify(n))},restore:function(){return window.localStorage.getItem(e.name)||{}}}}},s={on:function(e,n){var t=this._events();(t[e]||(t[e]=[])).push(n)},off:function(e,n){var t=this._events(e);t&&t.splice(t.indexOf(n),1)},emit:function(e){for(var n=[].slice.call(arguments,1),t=this._events()[e]||[],i=0,o=t.length;o>i;i++)t[i].apply(this,n)},once:function(e,n){function t(){n.apply(this,arguments),this.off(e,t)}this.on(e,t)},_events:function(){return this.__events||(this.__events={}),this.__events}};"undefined"!=typeof module&&module.exports?module.exports=i:e.keyval=i}(this);