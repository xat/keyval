!function(e){function n(){}function t(){for(var e={},n=0;n<arguments.length;n++){var t=arguments[n];for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}return e}var i=function(e){e=t({engine:"memory"},e);var n,i,s={},a=0;return n="string"==typeof e.engine?o[e.engine]():"function"==typeof e.engine?e.engine():o[e.engine.name](e.engine),i=t({get:function(e){return s[e]},set:function(e,n,t){var i=this.has(e)?"update":"add";this.emit(i+":"+e,n,e),this.emit(i,n,e),s[e]=n,t&&this.save()},has:function(e){return e in s},remove:function(e,n){this.emit("remove:"+e,s[e],e),this.emit("remove",s[e],e),delete s[e],n&&this.save()},count:function(){return a},each:function(e){for(var n in s)s.hasOwnProperty(n)&&e(s[n],n)},getAll:function(){return s},removeAll:function(e){var n=this;this.each(function(e,t){n.remove(t)}),e&&this.save()},save:function(){this.emit("save",s),n.save(s)},load:function(){var e=this;s=n.restore(),this.emit("load",s),this.each(function(n,t){e.emit("add:"+t,s[t],t),e.emit("add",s[t],t)})}},r),i.on("load",function(){a=0}),i.on("add",function(){a++}),i.on("remove",function(){a--}),i},o={memory:function(){return{save:n,restore:function(){return{}}}},session:function(e){return e=t(e,{name:"keyval.default"}),{save:function(n){window.sessionStorage.setItem(e.name,JSON.stringify(n))},restore:function(){return JSON.parse(window.sessionStorage.getItem(e.name))||{}}}},local:function(e){return e=t(e,{name:"keyval.default"}),{save:function(n){window.localStorage.setItem(e.name,JSON.stringify(n))},restore:function(){return JSON.parse(window.localStorage.getItem(e.name))||{}}}}},r={on:function(e,n){var t=this._events();(t[e]||(t[e]=[])).push(n)},off:function(e,n){var t=this._events(e);t&&t.splice(t.indexOf(n),1)},emit:function(e){for(var n=[].slice.call(arguments,1),t=this._events()[e]||[],i=0,o=t.length;o>i;i++)t[i].apply(this,n)},once:function(e,n){function t(){n.apply(this,arguments),this.off(e,t)}this.on(e,t)},_events:function(){return this.__events||(this.__events={}),this.__events}};"undefined"!=typeof module&&module.exports?module.exports=i:e.keyval=i}(this);